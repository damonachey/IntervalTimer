<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interval Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 5px 0;
        }
        #add-timer {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            background-color: #4a90e2;
            color: white;
            border: none;
        }
        #settings-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 28px;
            padding: 5px;
            color: #666;
        }
        #settings-button:hover {
            color: #4a90e2;
        }
        button {
            display: block;
            margin: 5px 0;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            border-radius: 5px;
        }
        .timer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 5px 0;
        }
        .timer-button {
            background-color: #6c757d;
            color: white;
            border: none;
            flex-grow: 1;
            text-align: left;
            margin-right: 10px;
            border-radius: 5px;
        }
        .timer-button.running {
            background-color: #28a745;
        }
        .timer-button.finished {
            background-color: #ffc107;
            color: #000;
        }
        .remove-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
            color: #666;
        }
        .remove-button:hover {
            color: #dc3545;
        }
        .timer-config {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .timer-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .timer-name {
            font-size: 18px;
            font-weight: bold;
        }
        .edit-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
            color: #666;
        }
        .edit-button:hover {
            color: #4a90e2;
        }
        .control-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        .control-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            text-align: center;
            width: 100%;
        }
        .control-button {
            background-color: #333;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .control-value {
            font-size: 32px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            cursor: pointer;
        }
        .control-value:hover {
            color: #4a90e2;
        }
        .time-part {
            display: inline-block;
            cursor: pointer;
        }
        .time-part:hover {
            color: #4a90e2;
        }
        .start-button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 18px;
            width: 100%;
            margin-top: 15px;
            text-align: center;
        }
        .fullscreen-timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: background-color 0.5s;
        }
        .fullscreen-timer.prepare {
            background-color: #ffc107;
        }
        .fullscreen-timer.work {
            background-color: #28a745;
        }
        .fullscreen-timer.break {
            background-color: #2196f3;
        }
        .fullscreen-timer.cooldown {
            background-color: #ffc107;
        }
        .timer-sets {
            font-size: 72px;
            font-weight: bold;
            color: rgba(0, 0, 0, 0.6);
            margin-bottom: 20px;
        }
        .timer-display {
            font-size: 120px;
            font-weight: bold;
            color: #000;
            margin-bottom: 20px;
        }
        .timer-phase {
            font-size: 36px;
            font-weight: normal;
            color: rgba(0, 0, 0, 0.4);
            text-transform: uppercase;
        }
        .pause-button {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.3);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000;
            line-height: 1;
        }
        .pause-button:hover {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .cancel-button {
            position: absolute;
            bottom: 40px;
            right: 120px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(220, 53, 69, 0.3);
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000;
            line-height: 1;
        }
        .cancel-button.visible {
            display: flex;
        }
        .cancel-button:hover {
            background-color: rgba(220, 53, 69, 0.5);
        }
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .settings-overlay.visible {
            display: flex;
        }
        .settings-panel {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }
        .settings-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .settings-row {
            margin: 20px 0;
        }
        .settings-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 10px;
        }
        .settings-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .settings-button {
            background-color: #333;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 18px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .settings-value {
            font-size: 24px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
            cursor: pointer;
        }
        .settings-value:hover {
            color: #4a90e2;
        }
        .settings-time-part {
            display: inline-block;
            cursor: pointer;
        }
        .settings-time-part:hover {
            color: #4a90e2;
        }
        .settings-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            justify-content: flex-end;
        }
        .settings-save, .settings-cancel {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
        }
        .settings-save {
            background-color: #4a90e2;
            color: white;
        }
        .settings-cancel {
            background-color: #e8e8e8;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Interval Timer</h1>
    <div class="header-container">
        <button id="add-timer">+ Add Timer</button>
        <button id="settings-button">⚙</button>
    </div>
    <div id="timers-container"></div>

    <div id="settings-overlay" class="settings-overlay">
        <div class="settings-panel">
            <div class="settings-title">Default Settings</div>

            <div class="settings-row">
                <div class="settings-label">SETS</div>
                <div class="settings-control">
                    <button class="settings-button" id="sets-dec">−</button>
                    <div class="settings-value" id="sets-value">1</div>
                    <button class="settings-button" id="sets-inc">+</button>
                </div>
            </div>

            <div class="settings-row">
                <div class="settings-label">WORK</div>
                <div class="settings-control">
                    <button class="settings-button" id="work-dec">−</button>
                    <div class="settings-value" id="work-value"></div>
                    <button class="settings-button" id="work-inc">+</button>
                </div>
            </div>

            <div class="settings-row">
                <div class="settings-label">BREAK</div>
                <div class="settings-control">
                    <button class="settings-button" id="break-dec">−</button>
                    <div class="settings-value" id="break-value"></div>
                    <button class="settings-button" id="break-inc">+</button>
                </div>
            </div>

            <div class="settings-row">
                <div class="settings-label">PREPARE</div>
                <div class="settings-control">
                    <button class="settings-button" id="prepare-dec">−</button>
                    <div class="settings-value" id="prepare-value">5</div>
                    <button class="settings-button" id="prepare-inc">+</button>
                </div>
            </div>

            <div class="settings-row">
                <div class="settings-label">COOLDOWN</div>
                <div class="settings-control">
                    <button class="settings-button" id="cooldown-dec">−</button>
                    <div class="settings-value" id="cooldown-value">5</div>
                    <button class="settings-button" id="cooldown-inc">+</button>
                </div>
            </div>

            <div class="settings-buttons">
                <button class="settings-cancel" id="settings-cancel">Cancel</button>
                <button class="settings-save" id="settings-save">Save</button>
            </div>
        </div>
    </div>

    <script>
        let timers = [];
        let activeTimer = null;
        let defaultSettings = {
            sets: 1,
            workMinutes: 0,
            workSeconds: 30,
            breakMinutes: 0,
            breakSeconds: 15,
            prepareSeconds: 5,
            cooldownSeconds: 5
        };

        // Update settings display
        function updateSettingsDisplay() {
            document.getElementById('sets-value').textContent = defaultSettings.sets;

            // Update work time with clickable parts
            const workValue = document.getElementById('work-value');
            workValue.innerHTML = '';
            const workMinSpan = document.createElement('span');
            workMinSpan.className = 'settings-time-part';
            workMinSpan.textContent = String(defaultSettings.workMinutes).padStart(2, '0');
            workMinSpan.addEventListener('click', (e) => {
                e.stopPropagation();
                const newValue = prompt('Enter work minutes:', defaultSettings.workMinutes);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0) {
                    defaultSettings.workMinutes = parsed;
                    updateSettingsDisplay();
                }
            });
            const workSecSpan = document.createElement('span');
            workSecSpan.className = 'settings-time-part';
            workSecSpan.textContent = String(defaultSettings.workSeconds).padStart(2, '0');
            workSecSpan.addEventListener('click', (e) => {
                e.stopPropagation();
                const newValue = prompt('Enter work seconds:', defaultSettings.workSeconds);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0 && parsed < 60) {
                    defaultSettings.workSeconds = parsed;
                    updateSettingsDisplay();
                }
            });
            workValue.appendChild(workMinSpan);
            workValue.appendChild(document.createTextNode(' : '));
            workValue.appendChild(workSecSpan);

            // Update break time with clickable parts
            const breakValue = document.getElementById('break-value');
            breakValue.innerHTML = '';
            const breakMinSpan = document.createElement('span');
            breakMinSpan.className = 'settings-time-part';
            breakMinSpan.textContent = String(defaultSettings.breakMinutes).padStart(2, '0');
            breakMinSpan.addEventListener('click', (e) => {
                e.stopPropagation();
                const newValue = prompt('Enter break minutes:', defaultSettings.breakMinutes);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0) {
                    defaultSettings.breakMinutes = parsed;
                    updateSettingsDisplay();
                }
            });
            const breakSecSpan = document.createElement('span');
            breakSecSpan.className = 'settings-time-part';
            breakSecSpan.textContent = String(defaultSettings.breakSeconds).padStart(2, '0');
            breakSecSpan.addEventListener('click', (e) => {
                e.stopPropagation();
                const newValue = prompt('Enter break seconds:', defaultSettings.breakSeconds);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0 && parsed < 60) {
                    defaultSettings.breakSeconds = parsed;
                    updateSettingsDisplay();
                }
            });
            breakValue.appendChild(breakMinSpan);
            breakValue.appendChild(document.createTextNode(' : '));
            breakValue.appendChild(breakSecSpan);

            document.getElementById('prepare-value').textContent = defaultSettings.prepareSeconds;
            document.getElementById('cooldown-value').textContent = defaultSettings.cooldownSeconds;
        }

        // Load settings and timers from local storage on page load
        window.onload = () => {
            // Load default settings
            const savedSettings = JSON.parse(localStorage.getItem('defaultSettings'));
            if (savedSettings) {
                defaultSettings = savedSettings;
            }
            updateSettingsDisplay();

            const savedTimers = JSON.parse(localStorage.getItem('timers')) || [];

            if (savedTimers.length === 0) {
                // Create default timer if none exist
                const defaultTimer = {
                    id: Date.now(),
                    name: "Timer",
                    sets: defaultSettings.sets,
                    workMinutes: defaultSettings.workMinutes,
                    workSeconds: defaultSettings.workSeconds,
                    breakMinutes: defaultSettings.breakMinutes,
                    breakSeconds: defaultSettings.breakSeconds,
                    element: document.createElement('div'),
                };
                createTimerElement(defaultTimer);
                timers.push(defaultTimer);
                saveTimersToLocalStorage();
            } else {
                savedTimers.forEach(savedTimer => {
                    const timer = {
                        id: savedTimer.id,
                        name: savedTimer.name,
                        sets: savedTimer.sets ?? 1,
                        workMinutes: savedTimer.workMinutes ?? 0,
                        workSeconds: savedTimer.workSeconds ?? 30,
                        breakMinutes: savedTimer.breakMinutes ?? 0,
                        breakSeconds: savedTimer.breakSeconds ?? 15,
                        element: document.createElement('div'),
                    };

                    createTimerElement(timer);
                    timers.push(timer);
                });
            }
        };

        // Settings button handler
        document.getElementById('settings-button').addEventListener('click', () => {
            updateSettingsDisplay();
            document.getElementById('settings-overlay').classList.add('visible');
        });

        // Add click handlers for sets, prepare, and cooldown
        document.getElementById('sets-value').addEventListener('click', () => {
            const newValue = prompt('Enter number of sets:', defaultSettings.sets);
            const parsed = parseInt(newValue);
            if (newValue && !isNaN(parsed) && parsed > 0) {
                defaultSettings.sets = parsed;
                updateSettingsDisplay();
            }
        });

        document.getElementById('prepare-value').addEventListener('click', () => {
            const newValue = prompt('Enter prepare seconds:', defaultSettings.prepareSeconds);
            const parsed = parseInt(newValue);
            if (newValue !== null && !isNaN(parsed) && parsed > 0) {
                defaultSettings.prepareSeconds = parsed;
                updateSettingsDisplay();
            }
        });

        document.getElementById('cooldown-value').addEventListener('click', () => {
            const newValue = prompt('Enter cooldown seconds:', defaultSettings.cooldownSeconds);
            const parsed = parseInt(newValue);
            if (newValue !== null && !isNaN(parsed) && parsed > 0) {
                defaultSettings.cooldownSeconds = parsed;
                updateSettingsDisplay();
            }
        });

        document.getElementById('settings-cancel').addEventListener('click', () => {
            document.getElementById('settings-overlay').classList.remove('visible');
        });

        // Settings increment/decrement handlers
        document.getElementById('sets-inc').addEventListener('click', () => {
            defaultSettings.sets++;
            updateSettingsDisplay();
        });
        document.getElementById('sets-dec').addEventListener('click', () => {
            if (defaultSettings.sets > 1) {
                defaultSettings.sets--;
                updateSettingsDisplay();
            }
        });

        document.getElementById('work-inc').addEventListener('click', () => {
            defaultSettings.workSeconds++;
            if (defaultSettings.workSeconds >= 60) {
                defaultSettings.workSeconds = 0;
                defaultSettings.workMinutes++;
            }
            updateSettingsDisplay();
        });
        document.getElementById('work-dec').addEventListener('click', () => {
            if (defaultSettings.workSeconds > 0) {
                defaultSettings.workSeconds--;
            } else if (defaultSettings.workMinutes > 0) {
                defaultSettings.workMinutes--;
                defaultSettings.workSeconds = 59;
            }
            updateSettingsDisplay();
        });

        document.getElementById('break-inc').addEventListener('click', () => {
            defaultSettings.breakSeconds++;
            if (defaultSettings.breakSeconds >= 60) {
                defaultSettings.breakSeconds = 0;
                defaultSettings.breakMinutes++;
            }
            updateSettingsDisplay();
        });
        document.getElementById('break-dec').addEventListener('click', () => {
            if (defaultSettings.breakSeconds > 0) {
                defaultSettings.breakSeconds--;
            } else if (defaultSettings.breakMinutes > 0) {
                defaultSettings.breakMinutes--;
                defaultSettings.breakSeconds = 59;
            }
            updateSettingsDisplay();
        });

        document.getElementById('prepare-inc').addEventListener('click', () => {
            defaultSettings.prepareSeconds++;
            updateSettingsDisplay();
        });
        document.getElementById('prepare-dec').addEventListener('click', () => {
            if (defaultSettings.prepareSeconds > 1) {
                defaultSettings.prepareSeconds--;
                updateSettingsDisplay();
            }
        });

        document.getElementById('cooldown-inc').addEventListener('click', () => {
            defaultSettings.cooldownSeconds++;
            updateSettingsDisplay();
        });
        document.getElementById('cooldown-dec').addEventListener('click', () => {
            if (defaultSettings.cooldownSeconds > 1) {
                defaultSettings.cooldownSeconds--;
                updateSettingsDisplay();
            }
        });

        document.getElementById('settings-save').addEventListener('click', () => {
            localStorage.setItem('defaultSettings', JSON.stringify(defaultSettings));
            document.getElementById('settings-overlay').classList.remove('visible');
        });

        document.getElementById('add-timer').addEventListener('click', () => {
            const timer = {
                id: Date.now(),
                name: "Timer",
                sets: defaultSettings.sets,
                workMinutes: defaultSettings.workMinutes,
                workSeconds: defaultSettings.workSeconds,
                breakMinutes: defaultSettings.breakMinutes,
                breakSeconds: defaultSettings.breakSeconds,
                element: document.createElement('div'),
            };

            createTimerElement(timer);
            timers.push(timer);
            saveTimersToLocalStorage();
        });


        function createTimerElement(timer) {
            timer.element.className = 'timer-config';

            // Header with name and edit button
            const header = document.createElement('div');
            header.className = 'timer-header';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'timer-name';
            nameSpan.textContent = timer.name;

            const editButton = document.createElement('button');
            editButton.className = 'edit-button';
            editButton.textContent = '✎';
            editButton.addEventListener('click', () => {
                const newName = prompt('Enter timer name:', timer.name);
                if (newName) {
                    timer.name = newName;
                    nameSpan.textContent = newName;
                    saveTimersToLocalStorage();
                }
            });

            const removeButton = document.createElement('button');
            removeButton.className = 'remove-button';
            removeButton.textContent = '✕';
            removeButton.style.marginLeft = 'auto';
            removeButton.addEventListener('click', () => handleRemoveTimer(timer));

            header.appendChild(nameSpan);
            header.appendChild(editButton);
            header.appendChild(removeButton);

            // Sets control
            const setsRow = document.createElement('div');
            setsRow.innerHTML = `<div class="control-label">SETS</div>`;

            const setsControl = document.createElement('div');
            setsControl.className = 'control-row';

            const setsDecButton = document.createElement('button');
            setsDecButton.className = 'control-button';
            setsDecButton.textContent = '−';
            setsDecButton.addEventListener('click', () => {
                if (timer.sets > 1) {
                    timer.sets--;
                    setsValue.textContent = timer.sets;
                    saveTimersToLocalStorage();
                }
            });

            const setsValue = document.createElement('div');
            setsValue.className = 'control-value';
            setsValue.textContent = timer.sets;
            setsValue.addEventListener('click', () => {
                const newValue = prompt('Enter number of sets:', timer.sets);
                const parsed = parseInt(newValue);
                if (newValue && !isNaN(parsed) && parsed > 0) {
                    timer.sets = parsed;
                    setsValue.textContent = timer.sets;
                    saveTimersToLocalStorage();
                }
            });

            const setsIncButton = document.createElement('button');
            setsIncButton.className = 'control-button';
            setsIncButton.textContent = '+';
            setsIncButton.addEventListener('click', () => {
                timer.sets++;
                setsValue.textContent = timer.sets;
                saveTimersToLocalStorage();
            });

            setsControl.appendChild(setsDecButton);
            setsControl.appendChild(setsValue);
            setsControl.appendChild(setsIncButton);

            // Work control
            const workRow = document.createElement('div');
            workRow.innerHTML = `<div class="control-label">WORK</div>`;

            const workControl = document.createElement('div');
            workControl.className = 'control-row';

            const workDecButton = document.createElement('button');
            workDecButton.className = 'control-button';
            workDecButton.textContent = '−';
            workDecButton.addEventListener('click', () => {
                if (timer.workSeconds > 0) {
                    timer.workSeconds--;
                } else if (timer.workMinutes > 0) {
                    timer.workMinutes--;
                    timer.workSeconds = 59;
                }
                workMinSpan.textContent = String(timer.workMinutes).padStart(2, '0');
                workSecSpan.textContent = String(timer.workSeconds).padStart(2, '0');
                saveTimersToLocalStorage();
            });

            const workValue = document.createElement('div');
            workValue.className = 'control-value';

            const workMinSpan = document.createElement('span');
            workMinSpan.className = 'time-part';
            workMinSpan.textContent = String(timer.workMinutes).padStart(2, '0');
            workMinSpan.addEventListener('click', () => {
                const newValue = prompt('Enter work minutes:', timer.workMinutes);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0) {
                    timer.workMinutes = parsed;
                    workMinSpan.textContent = String(timer.workMinutes).padStart(2, '0');
                    saveTimersToLocalStorage();
                }
            });

            const workSecSpan = document.createElement('span');
            workSecSpan.className = 'time-part';
            workSecSpan.textContent = String(timer.workSeconds).padStart(2, '0');
            workSecSpan.addEventListener('click', () => {
                const newValue = prompt('Enter work seconds:', timer.workSeconds);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0 && parsed < 60) {
                    timer.workSeconds = parsed;
                    workSecSpan.textContent = String(timer.workSeconds).padStart(2, '0');
                    saveTimersToLocalStorage();
                }
            });

            workValue.appendChild(workMinSpan);
            workValue.appendChild(document.createTextNode(' : '));
            workValue.appendChild(workSecSpan);

            const workIncButton = document.createElement('button');
            workIncButton.className = 'control-button';
            workIncButton.textContent = '+';
            workIncButton.addEventListener('click', () => {
                timer.workSeconds++;
                if (timer.workSeconds >= 60) {
                    timer.workSeconds = 0;
                    timer.workMinutes++;
                }
                workMinSpan.textContent = String(timer.workMinutes).padStart(2, '0');
                workSecSpan.textContent = String(timer.workSeconds).padStart(2, '0');
                saveTimersToLocalStorage();
            });

            workControl.appendChild(workDecButton);
            workControl.appendChild(workValue);
            workControl.appendChild(workIncButton);

            // Break control
            const breakRow = document.createElement('div');
            breakRow.innerHTML = `<div class="control-label">BREAK</div>`;

            const breakControl = document.createElement('div');
            breakControl.className = 'control-row';

            const breakDecButton = document.createElement('button');
            breakDecButton.className = 'control-button';
            breakDecButton.textContent = '−';
            breakDecButton.addEventListener('click', () => {
                if (timer.breakSeconds > 0) {
                    timer.breakSeconds--;
                } else if (timer.breakMinutes > 0) {
                    timer.breakMinutes--;
                    timer.breakSeconds = 59;
                }
                breakMinSpan.textContent = String(timer.breakMinutes).padStart(2, '0');
                breakSecSpan.textContent = String(timer.breakSeconds).padStart(2, '0');
                saveTimersToLocalStorage();
            });

            const breakValue = document.createElement('div');
            breakValue.className = 'control-value';

            const breakMinSpan = document.createElement('span');
            breakMinSpan.className = 'time-part';
            breakMinSpan.textContent = String(timer.breakMinutes).padStart(2, '0');
            breakMinSpan.addEventListener('click', () => {
                const newValue = prompt('Enter break minutes:', timer.breakMinutes);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0) {
                    timer.breakMinutes = parsed;
                    breakMinSpan.textContent = String(timer.breakMinutes).padStart(2, '0');
                    saveTimersToLocalStorage();
                }
            });

            const breakSecSpan = document.createElement('span');
            breakSecSpan.className = 'time-part';
            breakSecSpan.textContent = String(timer.breakSeconds).padStart(2, '0');
            breakSecSpan.addEventListener('click', () => {
                const newValue = prompt('Enter break seconds:', timer.breakSeconds);
                const parsed = parseInt(newValue);
                if (newValue !== null && !isNaN(parsed) && parsed >= 0 && parsed < 60) {
                    timer.breakSeconds = parsed;
                    breakSecSpan.textContent = String(timer.breakSeconds).padStart(2, '0');
                    saveTimersToLocalStorage();
                }
            });

            breakValue.appendChild(breakMinSpan);
            breakValue.appendChild(document.createTextNode(' : '));
            breakValue.appendChild(breakSecSpan);

            const breakIncButton = document.createElement('button');
            breakIncButton.className = 'control-button';
            breakIncButton.textContent = '+';
            breakIncButton.addEventListener('click', () => {
                timer.breakSeconds++;
                if (timer.breakSeconds >= 60) {
                    timer.breakSeconds = 0;
                    timer.breakMinutes++;
                }
                breakMinSpan.textContent = String(timer.breakMinutes).padStart(2, '0');
                breakSecSpan.textContent = String(timer.breakSeconds).padStart(2, '0');
                saveTimersToLocalStorage();
            });

            breakControl.appendChild(breakDecButton);
            breakControl.appendChild(breakValue);
            breakControl.appendChild(breakIncButton);

            // Start button
            const startButton = document.createElement('button');
            startButton.className = 'start-button';
            startButton.textContent = 'START';
            startButton.addEventListener('click', () => handleStartTimer(timer));

            // Assemble
            timer.element.appendChild(header);
            timer.element.appendChild(setsRow);
            timer.element.appendChild(setsControl);
            timer.element.appendChild(workRow);
            timer.element.appendChild(workControl);
            timer.element.appendChild(breakRow);
            timer.element.appendChild(breakControl);
            timer.element.appendChild(startButton);

            const container = document.getElementById('timers-container');
            container.insertBefore(timer.element, container.firstChild);
        }

        function handleStartTimer(timer) {
            // Create fullscreen overlay
            const fullscreen = document.createElement('div');
            fullscreen.className = 'fullscreen-timer prepare';

            const setsDisplay = document.createElement('div');
            setsDisplay.className = 'timer-sets';

            const timeDisplay = document.createElement('div');
            timeDisplay.className = 'timer-display';

            const phaseDisplay = document.createElement('div');
            phaseDisplay.className = 'timer-phase';

            const pauseButton = document.createElement('button');
            pauseButton.className = 'pause-button';
            pauseButton.textContent = '⏸';

            const cancelButton = document.createElement('button');
            cancelButton.className = 'cancel-button';
            cancelButton.textContent = '✕';

            fullscreen.appendChild(setsDisplay);
            fullscreen.appendChild(timeDisplay);
            fullscreen.appendChild(phaseDisplay);
            fullscreen.appendChild(pauseButton);
            fullscreen.appendChild(cancelButton);

            document.body.appendChild(fullscreen);

            // Timer state
            let currentSet = 0;
            let phase = 'prepare'; // prepare, work, break, cooldown
            let remainingSeconds = defaultSettings.prepareSeconds;
            let isPaused = false;
            let intervalId = null;

            // Update display
            function updateDisplay() {
                setsDisplay.textContent = `${currentSet} / ${timer.sets}`;
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                timeDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                phaseDisplay.textContent = phase === 'prepare' ? 'prepare' : phase;

                // Update background color
                fullscreen.className = 'fullscreen-timer ' + phase;
            }

            // Timer tick
            function tick() {
                if (isPaused) return;

                remainingSeconds--;
                updateDisplay();

                if (remainingSeconds <= 0) {
                    // Move to next phase
                    if (phase === 'prepare') {
                        currentSet = 1;
                        phase = 'work';
                        remainingSeconds = timer.workMinutes * 60 + timer.workSeconds;
                    } else if (phase === 'work') {
                        if (currentSet < timer.sets) {
                            phase = 'break';
                            remainingSeconds = timer.breakMinutes * 60 + timer.breakSeconds;
                        } else {
                            // Last work cycle done, go to cooldown
                            phase = 'cooldown';
                            remainingSeconds = defaultSettings.cooldownSeconds;
                        }
                    } else if (phase === 'break') {
                        currentSet++;
                        phase = 'work';
                        remainingSeconds = timer.workMinutes * 60 + timer.workSeconds;
                    } else if (phase === 'cooldown') {
                        // Timer complete
                        clearInterval(intervalId);
                        playAlert();
                        setTimeout(() => {
                            fullscreen.remove();
                        }, 2000);
                        return;
                    }
                    playAlert();
                    updateDisplay();
                }
            }

            // Pause/Resume functionality
            pauseButton.addEventListener('click', () => {
                isPaused = !isPaused;
                pauseButton.textContent = isPaused ? '▶' : '⏸';
                if (isPaused) {
                    cancelButton.classList.add('visible');
                } else {
                    cancelButton.classList.remove('visible');
                }
            });

            // Cancel functionality
            cancelButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to cancel the timer?')) {
                    clearInterval(intervalId);
                    fullscreen.remove();
                    document.removeEventListener('keydown', handleKeypress);
                }
            });

            // Exit on Escape key
            function handleKeypress(e) {
                if (e.key === 'Escape') {
                    clearInterval(intervalId);
                    fullscreen.remove();
                    document.removeEventListener('keydown', handleKeypress);
                }
            }
            document.addEventListener('keydown', handleKeypress);

            // Start timer
            updateDisplay();
            intervalId = setInterval(tick, 1000);
        }

        function playAlert() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Ignore audio errors
            }
        }

        function handleRemoveTimer(timer) {
            if (confirm(`Are you sure you want to remove the timer: ${timer.name}?`)) {
                if (timer === activeTimer) {
                    activeTimer = null;
                }
                timer.element.remove();
                timers = timers.filter(t => t !== timer);
                saveTimersToLocalStorage();
            }
        }


        function saveTimersToLocalStorage() {
            const dataToSave = timers.map(timer => ({
                id: timer.id,
                name: timer.name,
                sets: timer.sets,
                workMinutes: timer.workMinutes,
                workSeconds: timer.workSeconds,
                breakMinutes: timer.breakMinutes,
                breakSeconds: timer.breakSeconds
            }));
            localStorage.setItem('timers', JSON.stringify(dataToSave));
        }
    </script>
</body>
</html>
